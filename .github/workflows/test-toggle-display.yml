name: Test Toggle Display Feature

on:
  workflow_dispatch:
  push:
    branches:
      - fix/aqua-tool-installation-conflicts
    paths:
      - '.github/workflows/test-toggle-display.yml'

jobs:
  test-toggle:
    runs-on: ubuntu-latest
    steps:
    - name: Test Toggle Display Feature
      run: |
        echo "ğŸ§ª Testing toggle display functionality..."
        
        # Create small test output
        cat > small_output.txt << 'EOF'
        Terragrunt will perform the following actions:

          # aws_instance.small will be created
          + resource "aws_instance" "small" {
              + ami           = "ami-12345678"
              + instance_type = "t3.micro"
            }

        Plan: 1 to add, 0 to change, 0 to destroy.
        EOF
        
        # Create large test output
        cat > large_output.txt << 'EOF'
        Terragrunt will perform the following actions:
        EOF
        
        # Add many resources to simulate large output
        for i in {1..50}; do
          cat >> large_output.txt << EOF
          # aws_instance.example_${i} will be created
          + resource "aws_instance" "example_${i}" {
              + ami                = "ami-12345678"
              + instance_type     = "t3.micro"
              + key_name          = "my-key-${i}"
            }
        
        EOF
        done
        
        echo "Plan: 50 to add, 0 to change, 0 to destroy." >> large_output.txt
        
        # Get file sizes
        small_size=$(wc -c < small_output.txt)
        large_size=$(wc -c < large_output.txt)
        
        # Create test summary with toggle displays
        {
          echo "## ğŸ§ª Toggle Display Feature Test Results"
          echo ""
          echo "### Small Output Test (${small_size} bytes)"
          echo "<details>"
          echo "<summary>ğŸ“‹ Small Terragrunt Plan Output (Click to expand)</summary>"
          echo ""
          echo '```hcl'
          cat small_output.txt
          echo '```'
          echo "</details>"
          echo ""
          echo "### Large Output Test (${large_size} bytes)"
          echo "<details>"
          echo "<summary>ğŸ“‹ Large Terragrunt Plan Output (Click to expand) - Size: ${large_size} bytes</summary>"
          echo ""
          echo '```hcl'
          
          if [ "$large_size" -gt 10000 ]; then
            echo "âš ï¸ Output truncated due to large size (${large_size} bytes)"
            echo ""
            echo "=== First 30 lines ==="
            head -30 large_output.txt
            echo ""
            echo "=== ... (content truncated) ==="
            echo ""
            echo "=== Last 10 lines ==="
            tail -10 large_output.txt
          else
            cat large_output.txt
          fi
          
          echo '```'
          echo "</details>"
          echo ""
          echo "### âœ… Test Results Summary"
          echo "- Small output: ${small_size} bytes (full display)"
          echo "- Large output: ${large_size} bytes (truncated display)"
          echo "- Toggle functionality: Working"
          echo "- File size reporting: Included"
          echo ""
          echo "---"
        } >> "$GITHUB_STEP_SUMMARY"
        
        echo "âœ… Toggle display tests completed!"
        echo "ğŸ“Š Small output size: ${small_size} bytes"
        echo "ğŸ“Š Large output size: ${large_size} bytes"
        echo "ğŸ“‹ Check the Summary tab to see the toggle display in action"
